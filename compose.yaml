services:
   app:
      build: .
      ports:
         - "${APP_PORT}:${APP_PORT}"
      env_file: .env
      depends_on:
         db:
            condition: service_healthy
      restart: unless-stopped
   db:
      image: postgres:16-alpine
      healthcheck:
         test: ["CMD-SHELL", "pg_isready -U $POSTGRES_USER"]
         interval: 5s
         timeout: 5s
         retries: 5
      env_file: .env
      volumes:
         - pgdata:/var/lib/postgresql/data
      ports:
         - "${POSTGRES_PORT}:5432"
      restart: unless-stopped

volumes:
   pgdata:
